<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最小構成のGemini出力</title>
</head>
<body>

    <h1>Gemini API 最小構成デモ</h1>
    
    <!-- 応答を出力する任意のエリア -->
    <div id="result" style="white-space: pre-wrap; padding: 15px; border: 1px solid #ccc; min-height: 100px; background-color: #f9f9f9;">
        Geminiからの応答を待機中...
    </div>

    <script>
        // =================================================================
        // ⚠️ 警告: セキュリティ上の理由から、APIキーを直接コードに書かないでください。
        // これは最小構成を実現するためのテスト目的のコードです。
        // =================================================================
        const resultDiv = document.getElementById('result');
        
        // --- 1. 設定値 ---
        const API_KEY = process.env.GEMINI_API_KEY; // 実際のAPIキーに置き換えてください
        const MODEL_NAME = "gemini-2.5-flash";
        const PROMPT = "猫の魅力について、簡潔に3つのポイントで教えてください。";
        
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        /**
         * APIを呼び出し、結果をHTMLに出力するメイン関数
         */
        async function run() {
            if (API_KEY === "YOUR_API_KEY_HERE" || API_KEY === "") {
                resultDiv.textContent = "エラー: APIキーを 'YOUR_API_KEY_HERE' から実際のキーに置き換えてください。";
                return;
            }

            resultDiv.textContent = "Gemini APIを呼び出し中...";

            try {
                // --- 2. Fetch APIでリクエストを送信 ---
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: PROMPT }] }]
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    // APIがエラーコードを返した場合の処理
                    const errorMessage = data.error?.message || `HTTPエラー: ${response.status}`;
                    resultDiv.textContent = `APIエラーが発生しました: ${errorMessage}`;
                    console.error("API Error Response:", data);
                    return;
                }

                // --- 3. 応答からテキストを抽出し、HTMLに出力 ---
                const generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (generatedText) {
                    // textContentで設定することで、XSS攻撃を防ぎつつ安全に出力します。
                    resultDiv.textContent = generatedText; 
                } else {
                    resultDiv.textContent = "エラー: 応答テキストを取得できませんでした。";
                    console.error("Empty Response Data:", data);
                }

            } catch (error) {
                // ネットワークやパースのエラー処理
                resultDiv.textContent = `ネットワークエラーが発生しました: ${error.message}`;
                console.error("Fetch/Network Error:", error);
            }
        }

        // ページロード時に実行
        run();
    </script>
</body>
</html>
